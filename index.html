<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>끈스튜디오 - AI 피팅 촬영 작업지시서</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <!-- 카카오톡 SDK -->
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.2/kakao.min.js" integrity="sha384-TiCUE00h649CAMonG018J2ujOgDKW/kVWlChEuu4jK2vxfAAD0eZxzCKakxg55G4" crossorigin="anonymous"></script>

    <style>
        /* 커스텀 CSS */
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }

        .font-noto {
            font-family: 'Noto Sans KR', sans-serif;
        }

        /* 라디오 버튼 및 체크박스 스타일링 */
        .gender-option:has(input:checked),
        .race-option:has(input:checked),
        .location-option:has(input:checked) {
            @apply border-indigo-500 bg-indigo-50;
        }

        .gender-option:has(input:checked) i,
        .race-option:has(input:checked) span,
        .location-option:has(input:checked) span {
            @apply text-indigo-600;
        }

        /* 파일 업로드 영역 호버 효과 */
        .file-upload-area:hover {
            @apply border-indigo-400 bg-indigo-50;
        }

        /* 이미지 미리보기 스타일 */
        .image-preview-item {
            @apply relative rounded-lg overflow-hidden shadow-md;
        }

        .image-preview-item img {
            @apply w-full h-24 object-cover;
        }

        .image-preview-item .remove-btn {
            @apply absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs cursor-pointer hover:bg-red-600;
        }

        /* 폼 애니메이션 */
        .form-group {
            @apply transform transition-all duration-200;
        }

        .form-group:hover {
            @apply translate-y-[-2px];
        }

        /* 버튼 애니메이션 */
        button {
            @apply transition-all duration-200;
        }

        /* 모달 애니메이션 */
        .modal-enter {
            animation: modalFadeIn 0.3s ease-out;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* 스크롤바 커스터마이징 */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* 반응형 디자인 개선 */
        @media (max-width: 768px) {
            .container {
                @apply px-2;
            }
            
            .form-group label {
                @apply text-xs;
            }
            
            .gender-option,
            .race-option,
            .location-option {
                @apply p-2 text-sm;
            }
            
            .gender-option i {
                @apply text-xl mb-1;
            }
            
            /* 모바일에서 그리드 조정 */
            .grid.grid-cols-3 {
                @apply grid-cols-1;
            }
            
            .grid.grid-cols-2.md\\:grid-cols-4 {
                @apply grid-cols-2;
            }
            
            .grid.grid-cols-2.md\\:grid-cols-3 {
                @apply grid-cols-2;
            }
            
            /* 모바일 텍스트 크기 조정 */
            h1 {
                @apply text-2xl;
            }
            
            h2 {
                @apply text-xl;
            }
            
            /* 모바일 버튼 크기 조정 */
            button[type="submit"] {
                @apply py-3 text-sm;
            }
            
            /* 모바일 입력 필드 조정 */
            input, textarea, select {
                @apply text-base py-2;
            }
            
            /* 모바일 모달 조정 */
            #resultModal > div {
                @apply mx-2 max-w-sm;
            }
        }

        @media (max-width: 480px) {
            /* 초소형 화면 대응 */
            .gender-option,
            .race-option,
            .location-option {
                @apply p-1 text-xs;
            }
            
            .gender-option i {
                @apply text-lg;
            }
            
            .grid.grid-cols-2 {
                @apply grid-cols-1;
            }
            
            /* 헤더 아이콘 크기 조정 */
            .fa-camera-retro {
                @apply text-4xl;
            }
            
            /* 폼 패딩 조정 */
            .bg-white.rounded-2xl > form {
                @apply p-4;
            }
            
            .bg-gradient-to-r.from-indigo-500 {
                @apply px-4 py-4;
            }
        }

        /* 테블릿 최적화 */
        @media (min-width: 768px) and (max-width: 1024px) {
            .container {
                @apply px-4;
            }
            
            .grid.grid-cols-2.md\\:grid-cols-4 {
                @apply grid-cols-3;
            }
        }

        /* 체크 표시 애니메이션 */
        .check-animation {
            animation: checkBounce 0.6s ease-in-out;
        }

        @keyframes checkBounce {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* 로딩 스피너 */
        .loading-spinner {
            @apply animate-spin rounded-full h-8 w-8 border-b-2 border-white;
        }

        /* 그래디언트 텍스트 */
        .gradient-text {
            background: linear-gradient(45deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* 카드 호버 효과 */
        .card-hover {
            @apply transition-all duration-300 hover:shadow-2xl hover:-translate-y-1;
        }

        /* 스타일 보완 - 선택된 옵션 스타일 */
        .gender-option.selected,
        .race-option.selected,
        .location-option.selected {
            border-color: #6366f1 !important;
            background-color: #eef2ff !important;
        }

        .gender-option.selected i,
        .race-option.selected span,
        .location-option.selected span {
            color: #6366f1 !important;
        }

        /* 모달 스크롤 최적화 */
        .max-h-90vh {
            max-height: 90vh;
        }
        
        /* 이미지 미리보기 그리드 개선 */
        #modalImagePreview img {
            transition: transform 0.2s ease;
        }
        
        #modalImagePreview img:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-indigo-100 min-h-screen font-noto">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- 헤더 -->
        <div class="text-center mb-8">
            <div class="mb-4">
                <i class="fas fa-camera-retro text-6xl text-indigo-600 mb-4"></i>
            </div>
            <h1 class="text-4xl font-bold text-gray-800 mb-2">끈스튜디오</h1>
            <p class="text-xl text-gray-600 mb-1">AI 피팅 촬영 서비스</p>
            <p class="text-sm text-gray-500">@kkeunstudio</p>
        </div>

        <!-- 작업지시서 폼 -->
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
            <div class="bg-gradient-to-r from-indigo-500 to-purple-600 px-8 py-6">
                <h2 class="text-2xl font-bold text-white flex items-center">
                    <i class="fas fa-clipboard-list mr-3"></i>
                    작업지시서
                </h2>
                <p class="text-indigo-100 mt-2">원하시는 AI 피팅 촬영을 위해 아래 정보를 입력해 주세요</p>
            </div>

            <form id="orderForm" class="p-8 space-y-6">
                <!-- 브랜드명 -->
                <div class="form-group">
                    <label for="brandName" class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-tag mr-2 text-indigo-500"></i>브랜드명 *
                    </label>
                    <input type="text" id="brandName" name="brandName" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors"
                           placeholder="예: 끈스튜디오">
                </div>

                <!-- 제작 컨셉 -->
                <div class="form-group">
                    <label for="concept" class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-lightbulb mr-2 text-indigo-500"></i>제작하고 싶은 컨셉 *
                    </label>
                    <textarea id="concept" name="concept" required rows="3"
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors"
                              placeholder="예: 캐주얼한 일상룩, 고급스러운 오피스룩, 트렌디한 스트릿패션 등"></textarea>
                </div>

                <!-- 모델 성별 -->
                <div class="form-group">
                    <label class="block text-sm font-semibold text-gray-700 mb-3">
                        <i class="fas fa-users mr-2 text-indigo-500"></i>모델 성별 *
                    </label>
                    <div class="grid grid-cols-3 gap-4">
                        <label class="flex items-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors gender-option">
                            <input type="radio" name="gender" value="여성" class="sr-only">
                            <div class="flex flex-col items-center w-full">
                                <i class="fas fa-female text-2xl text-pink-500 mb-2"></i>
                                <span class="font-medium">여성</span>
                            </div>
                        </label>
                        <label class="flex items-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors gender-option">
                            <input type="radio" name="gender" value="남성" class="sr-only">
                            <div class="flex flex-col items-center w-full">
                                <i class="fas fa-male text-2xl text-blue-500 mb-2"></i>
                                <span class="font-medium">남성</span>
                            </div>
                        </label>
                        <label class="flex items-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors gender-option">
                            <input type="radio" name="gender" value="무관" class="sr-only">
                            <div class="flex flex-col items-center w-full">
                                <i class="fas fa-genderless text-2xl text-gray-500 mb-2"></i>
                                <span class="font-medium">무관</span>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- 모델 인종 -->
                <div class="form-group">
                    <label class="block text-sm font-semibold text-gray-700 mb-3">
                        <i class="fas fa-globe mr-2 text-indigo-500"></i>모델 인종 *
                    </label>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors race-option">
                            <input type="radio" name="race" value="동양인" class="sr-only">
                            <span class="font-medium text-center w-full">동양인</span>
                        </label>
                        <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors race-option">
                            <input type="radio" name="race" value="백인" class="sr-only">
                            <span class="font-medium text-center w-full">백인</span>
                        </label>
                        <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors race-option">
                            <input type="radio" name="race" value="흑인" class="sr-only">
                            <span class="font-medium text-center w-full">흑인</span>
                        </label>
                        <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors race-option">
                            <input type="radio" name="race" value="무관" class="sr-only">
                            <span class="font-medium text-center w-full">무관</span>
                        </label>
                    </div>
                </div>

                <!-- 촬영 장소/배경 -->
                <div class="form-group">
                    <label class="block text-sm font-semibold text-gray-700 mb-3">
                        <i class="fas fa-map-marker-alt mr-2 text-indigo-500"></i>촬영 장소/배경
                    </label>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                        <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors location-option">
                            <input type="checkbox" name="location" value="스튜디오" class="sr-only">
                            <span class="font-medium text-center w-full">스튜디오</span>
                        </label>
                        <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors location-option">
                            <input type="checkbox" name="location" value="야외" class="sr-only">
                            <span class="font-medium text-center w-full">야외</span>
                        </label>
                        <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors location-option">
                            <input type="checkbox" name="location" value="카페" class="sr-only">
                            <span class="font-medium text-center w-full">카페</span>
                        </label>
                        <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors location-option">
                            <input type="checkbox" name="location" value="거리" class="sr-only">
                            <span class="font-medium text-center w-full">거리</span>
                        </label>
                        <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors location-option">
                            <input type="checkbox" name="location" value="사무실" class="sr-only">
                            <span class="font-medium text-center w-full">사무실</span>
                        </label>
                        <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors location-option">
                            <input type="checkbox" name="location" value="기타" class="sr-only">
                            <span class="font-medium text-center w-full">기타</span>
                        </label>
                    </div>
                    <input type="text" id="customLocation" name="customLocation" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors mt-3 hidden"
                           placeholder="원하시는 장소를 직접 입력해 주세요">
                </div>

                <!-- 상품 사진 업로드 -->
                <div class="form-group">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-camera mr-2 text-indigo-500"></i>상품 사진 (착용컷 권장) *
                    </label>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-indigo-400 transition-colors">
                        <input type="file" id="productImages" name="productImages" multiple accept="image/*" class="hidden">
                        <label for="productImages" class="cursor-pointer">
                            <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                            <p class="text-gray-600 font-medium mb-2">클릭하여 이미지 업로드</p>
                            <p class="text-sm text-gray-400">PNG, JPG, JPEG 파일을 선택해 주세요 (최대 10MB)</p>
                        </label>
                    </div>
                    <div id="imagePreview" class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 hidden"></div>
                </div>

                <!-- 연락처 -->
                <div class="form-group">
                    <label for="contact" class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-phone mr-2 text-indigo-500"></i>연락처 *
                    </label>
                    <input type="text" id="contact" name="contact" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors"
                           placeholder="010-0000-0000">
                </div>

                <!-- 추가 요청사항 -->
                <div class="form-group">
                    <label for="additionalRequest" class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-comment-dots mr-2 text-indigo-500"></i>추가 요청사항
                    </label>
                    <textarea id="additionalRequest" name="additionalRequest" rows="3"
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors"
                              placeholder="특별한 포즈나 분위기, 기타 요청사항을 입력해 주세요"></textarea>
                </div>

                <!-- 제출 버튼 -->
                <div class="pt-6">
                    <button type="submit" 
                            id="submitButton"
                            onclick="console.log('버튼 클릭 - onclick 이벤트'); handleFormSubmitDirect(event);"
                            class="w-full bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-semibold py-4 px-6 rounded-lg hover:from-indigo-600 hover:to-purple-700 transform hover:scale-105 transition-all duration-200 shadow-lg">
                        <i class="fas fa-copy mr-2"></i>
                        작업지시서 완료 후 링크 복사하기
                    </button>
                </div>
            </form>
        </div>

        <!-- 결과 모달 -->
        <div id="resultModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white rounded-2xl p-8 max-w-2xl mx-4 text-center max-h-90vh overflow-y-auto">
                <i class="fas fa-check-circle text-5xl text-green-500 mb-4"></i>
                <h3 class="text-2xl font-bold text-gray-800 mb-4">작업지시서 완료!</h3>
                <p class="text-gray-600 mb-4">작업지시서가 성공적으로 저장되었습니다.<br>카카오톡으로 전송해 주세요!</p>
                
                <div class="space-y-3">
                    <button id="sendKakao" 
                            class="w-full bg-blue-500 text-white font-semibold py-3 px-6 rounded-lg hover:bg-blue-600 transition-colors">
                        <i class="fas fa-copy mr-2"></i>
                        링크 복사하기
                    </button>
                    <button id="closeModal" 
                            class="w-full bg-gray-200 text-gray-800 font-medium py-2 px-4 rounded-lg hover:bg-gray-300 transition-colors">
                        닫기
                    </button>
                </div>
            </div>
        </div>

        <!-- 푸터 -->
        <div class="text-center mt-8 text-gray-500">
            <p class="text-sm">© 2024 끈스튜디오 | AI 피팅 촬영 서비스</p>
            <p class="text-xs mt-1">카카오톡 채널: @kkeunstudio</p>
            <div class="mt-4">
                <a href="admin.html" class="text-xs text-gray-400 hover:text-gray-600 transition-colors">
                    <i class="fas fa-cog mr-1"></i>관리자 페이지
                </a>
            </div>
        </div>
    </div>

    <script>
        // 전역 변수
        let orderData = {};
        let uploadedImages = [];

        // DOM 로드 완료 시 실행
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM 로드 완료');
            initializeApp();
            checkForSharedData();
        });

        // 백업: 윈도우 로드 완료 시에도 실행 (DOMContentLoaded가 실행되지 않는 경우를 대비)
        window.addEventListener('load', function() {
            console.log('윈도우 로드 완료');
            
            // 폼이 이미 초기화되지 않았다면 다시 시도
            const orderForm = document.getElementById('orderForm');
            if (orderForm && !orderForm.dataset.initialized) {
                console.log('폼 재초기화 시도');
                setupEventListeners();
                orderForm.dataset.initialized = 'true';
            }
        });

        // 앱 초기화
        function initializeApp() {
            console.log('앱 초기화 시작');
            
            // 카카오톡 SDK 초기화
            if (typeof Kakao !== 'undefined') {
                Kakao.init('YOUR_KAKAO_APP_KEY'); // 실제 사용시에는 카카오 개발자센터에서 발급받은 앱 키를 사용하세요
                console.log('카카오톡 SDK 초기화 완료:', Kakao.isInitialized());
            } else {
                console.log('카카오톡 SDK 로드되지 않음');
            }
            
            setupEventListeners();
            setupFormValidation();
            setupImageUpload();
            setupCustomOptions();
            
            console.log('앱 초기화 완료');
        }

        // 이벤트 리스너 설정
        function setupEventListeners() {
            console.log('이벤트 리스너 설정 시작');
            
            // 폼 제출
            const orderForm = document.getElementById('orderForm');
            console.log('orderForm 요소:', orderForm);
            
            if (orderForm) {
                orderForm.addEventListener('submit', handleFormSubmit);
                orderForm.dataset.initialized = 'true';
                console.log('폼 제출 이벤트 리스너 추가 완료');
                
                // 추가 디버깅: 직접 버튼 클릭 이벤트도 추가
                const submitButton = orderForm.querySelector('button[type="submit"]');
                console.log('제출 버튼:', submitButton);
                
                if (submitButton) {
                    submitButton.addEventListener('click', function(e) {
                        console.log('버튼 클릭됨 - 이벤트 타입:', e.type);
                        // 폼 제출은 handleFormSubmit에서 처리됨
                    });
                }
            } else {
                console.error('orderForm을 찾을 수 없습니다!');
            }
            
            // 모달 관련
            const closeModalBtn = document.getElementById('closeModal');
            const sendKakaoBtn = document.getElementById('sendKakao');
            
            if (closeModalBtn) {
                closeModalBtn.addEventListener('click', closeModal);
                console.log('모달 닫기 이벤트 리스너 추가 완료');
            }
            
            if (sendKakaoBtn) {
                sendKakaoBtn.addEventListener('click', sendToKakao);
                console.log('카카오 전송 이벤트 리스너 추가 완료');
            }
            
            // 라디오 버튼 및 체크박스 스타일링
            setupOptionSelections();
        }

        // 옵션 선택 스타일링 설정
        function setupOptionSelections() {
            // 성별 선택
            document.querySelectorAll('input[name="gender"]').forEach(input => {
                input.addEventListener('change', function() {
                    document.querySelectorAll('.gender-option').forEach(option => {
                        option.classList.remove('selected', 'border-indigo-500', 'bg-indigo-50');
                    });
                    if (this.checked) {
                        this.closest('.gender-option').classList.add('selected', 'border-indigo-500', 'bg-indigo-50');
                    }
                });
            });
            
            // 인종 선택
            document.querySelectorAll('input[name="race"]').forEach(input => {
                input.addEventListener('change', function() {
                    document.querySelectorAll('.race-option').forEach(option => {
                        option.classList.remove('selected', 'border-indigo-500', 'bg-indigo-50');
                    });
                    if (this.checked) {
                        this.closest('.race-option').classList.add('selected', 'border-indigo-500', 'bg-indigo-50');
                    }
                });
            });
            
            // 장소 선택 (다중 선택)
            document.querySelectorAll('input[name="location"]').forEach(input => {
                input.addEventListener('change', function() {
                    const option = this.closest('.location-option');
                    if (this.checked) {
                        option.classList.add('selected', 'border-indigo-500', 'bg-indigo-50');
                        // "기타" 선택 시 입력 필드 표시
                        if (this.value === '기타') {
                            document.getElementById('customLocation').classList.remove('hidden');
                        }
                    } else {
                        option.classList.remove('selected', 'border-indigo-500', 'bg-indigo-50');
                        // "기타" 해제 시 입력 필드 숨김
                        if (this.value === '기타') {
                            document.getElementById('customLocation').classList.add('hidden');
                            document.getElementById('customLocation').value = '';
                        }
                    }
                });
            });
        }

        // 커스텀 옵션 설정
        function setupCustomOptions() {
            // 기타 장소 입력 필드 처리는 위에서 이미 구현됨
        }

        // 이미지 업로드 설정
        function setupImageUpload() {
            const fileInput = document.getElementById('productImages');
            const preview = document.getElementById('imagePreview');
            
            fileInput.addEventListener('change', function(e) {
                handleImageUpload(e.target.files);
            });
            
            // 드래그 앤 드롭 기능
            const uploadArea = fileInput.parentElement;
            
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.classList.add('border-indigo-400', 'bg-indigo-50');
            });
            
            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('border-indigo-400', 'bg-indigo-50');
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('border-indigo-400', 'bg-indigo-50');
                handleImageUpload(e.dataTransfer.files);
            });
        }

        // 이미지 업로드 처리
        function handleImageUpload(files) {
            const preview = document.getElementById('imagePreview');
            const maxFiles = 10;
            const maxSize = 10 * 1024 * 1024; // 10MB
            
            // 파일 수 제한
            if (uploadedImages.length + files.length > maxFiles) {
                alert(`최대 ${maxFiles}개의 이미지만 업로드할 수 있습니다.`);
                return;
            }
            
            Array.from(files).forEach(file => {
                // 파일 크기 제한
                if (file.size > maxSize) {
                    alert(`${file.name} 파일이 너무 큽니다. 10MB 이하의 파일을 선택해 주세요.`);
                    return;
                }
                
                // 이미지 파일 타입 검사
                if (!file.type.startsWith('image/')) {
                    alert(`${file.name}은(는) 이미지 파일이 아닙니다.`);
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageData = {
                        file: file,
                        url: e.target.result,
                        name: file.name
                    };
                    
                    uploadedImages.push(imageData);
                    addImagePreview(imageData, uploadedImages.length - 1);
                    
                    // 미리보기 영역 표시
                    preview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            });
        }

        // 이미지 미리보기 추가
        function addImagePreview(imageData, index) {
            const preview = document.getElementById('imagePreview');
            const div = document.createElement('div');
            div.className = 'image-preview-item relative';
            div.innerHTML = `
                <img src="${imageData.url}" alt="${imageData.name}" class="w-full h-24 object-cover rounded-lg">
                <button type="button" class="remove-btn" onclick="removeImage(${index})">
                    <i class="fas fa-times"></i>
                </button>
                <p class="text-xs text-gray-500 mt-1 truncate">${imageData.name}</p>
            `;
            preview.appendChild(div);
        }

        // 이미지 제거
        function removeImage(index) {
            uploadedImages.splice(index, 1);
            const preview = document.getElementById('imagePreview');
            preview.innerHTML = '';
            
            // 다시 렌더링
            uploadedImages.forEach((imageData, i) => {
                addImagePreview(imageData, i);
            });
            
            // 이미지가 없으면 미리보기 영역 숨김
            if (uploadedImages.length === 0) {
                preview.classList.add('hidden');
            }
        }

        // 폼 유효성 검사 설정
        function setupFormValidation() {
            const form = document.getElementById('orderForm');
            const inputs = form.querySelectorAll('input[required], textarea[required]');
            
            inputs.forEach(input => {
                input.addEventListener('blur', validateField);
                input.addEventListener('input', clearFieldError);
            });
        }

        // 필드 유효성 검사
        function validateField(e) {
            const field = e.target;
            const value = field.value.trim();
            
            // 기존 에러 메시지 제거
            clearFieldError(e);
            
            if (!value) {
                showFieldError(field, '이 필드는 필수입니다.');
                return false;
            }
            
            // 연락처 형식 검사
            if (field.name === 'contact') {
                const phoneRegex = /^010-\d{4}-\d{4}$/;
                if (!phoneRegex.test(value)) {
                    showFieldError(field, '010-0000-0000 형식으로 입력해 주세요.');
                    return false;
                }
            }
            
            return true;
        }

        // 필드 에러 표시
        function showFieldError(field, message) {
            field.classList.add('border-red-500');
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'text-red-500 text-sm mt-1 error-message';
            errorDiv.textContent = message;
            
            field.parentElement.appendChild(errorDiv);
        }

        // 필드 에러 제거
        function clearFieldError(e) {
            const field = e.target;
            field.classList.remove('border-red-500');
            
            const errorMessage = field.parentElement.querySelector('.error-message');
            if (errorMessage) {
                errorMessage.remove();
            }
        }

        // 폼 제출 처리 (메인)
        function handleFormSubmit(e) {
            e.preventDefault();
            console.log('폼 제출 이벤트 발생 (addEventListener)');
            processFormSubmission();
        }

        // 폼 제출 처리 (백업 - onclick에서 호출)
        function handleFormSubmitDirect(e) {
            e.preventDefault();
            console.log('폼 제출 이벤트 발생 (onclick)');
            processFormSubmission();
        }

        // 실제 폼 처리 로직
        function processFormSubmission() {
            if (!validateForm()) {
                console.log('폼 유효성 검사 실패');
                return;
            }
            
            console.log('폼 유효성 검사 통과');
            
            // 로딩 표시
            showLoading();
            
            // 폼 데이터 수집
            collectFormData();
            
            // 간단한 지연 후 모달 표시
            setTimeout(() => {
                hideLoading();
                showResultModal();
                console.log('모달 표시 완료');
            }, 1000);
        }

        // 전체 폼 유효성 검사
        function validateForm() {
            const form = document.getElementById('orderForm');
            let isValid = true;
            
            console.log('유효성 검사 시작');
            
            // 필수 필드 검사 - 브랜드명과 컨셉만 체크
            const brandName = document.getElementById('brandName').value.trim();
            const concept = document.getElementById('concept').value.trim();
            const contact = document.getElementById('contact').value.trim();
            
            if (!brandName) {
                alert('브랜드명을 입력해 주세요.');
                isValid = false;
            }
            
            if (!concept) {
                alert('제작 컨셉을 입력해 주세요.');
                isValid = false;
            }
            
            if (!contact) {
                alert('연락처를 입력해 주세요.');
                isValid = false;
            }
            
            // 성별 선택 검사
            const genderSelected = form.querySelector('input[name="gender"]:checked');
            if (!genderSelected) {
                alert('모델 성별을 선택해 주세요.');
                isValid = false;
            }
            
            // 인종 선택 검사
            const raceSelected = form.querySelector('input[name="race"]:checked');
            if (!raceSelected) {
                alert('모델 인종을 선택해 주세요.');
                isValid = false;
            }
            
            // 이미지 업로드는 선택사항으로 변경
            console.log('유효성 검사 결과:', isValid);
            
            return isValid;
        }

        // 폼 데이터 수집
        function collectFormData() {
            const form = document.getElementById('orderForm');
            const formData = new FormData(form);
            
            console.log('데이터 수집 시작');
            
            orderData = {
                brandName: formData.get('brandName') || '',
                concept: formData.get('concept') || '',
                gender: formData.get('gender') || '',
                race: formData.get('race') || '',
                locations: getSelectedLocations(),
                customLocation: formData.get('customLocation') || '',
                contact: formData.get('contact') || '',
                additionalRequest: formData.get('additionalRequest') || '',
                images: uploadedImages || [],
                timestamp: new Date().toLocaleString('ko-KR')
            };
            
            console.log('수집된 데이터:', orderData);
        }

        // 선택된 장소 가져오기
        function getSelectedLocations() {
            const locations = [];
            document.querySelectorAll('input[name="location"]:checked').forEach(input => {
                locations.push(input.value);
            });
            return locations;
        }

        // 로딩 표시
        function showLoading() {
            const button = document.querySelector('button[type="submit"]');
            const originalText = button.innerHTML;
            button.innerHTML = '<div class="loading-spinner mx-auto"></div>';
            button.disabled = true;
            button.dataset.originalText = originalText;
        }

        // 로딩 숨김
        function hideLoading() {
            const button = document.querySelector('button[type="submit"]');
            button.innerHTML = button.dataset.originalText;
            button.disabled = false;
        }

        // 결과 모달 표시
        function showResultModal() {
            const modal = document.getElementById('resultModal');
            
            // 업로드된 이미지들을 모달에 미리보기로 표시
            displayModalImagePreview();
            
            modal.classList.remove('hidden');
            modal.classList.add('flex', 'modal-enter');
            
            // 체크 아이콘 애니메이션
            setTimeout(() => {
                const checkIcon = modal.querySelector('.fa-check-circle');
                checkIcon.classList.add('check-animation');
            }, 100);
        }

        // 모달에 이미지 미리보기 표시
        function displayModalImagePreview() {
            const previewContainer = document.getElementById('modalImagePreview');
            
            if (orderData.images && orderData.images.length > 0) {
                previewContainer.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-semibold text-gray-700">📸 업로드된 상품사진 (${orderData.images.length}장)</h4>
                            <button onclick="downloadAllImagesAsZip()" class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600 transition-colors">
                                <i class="fas fa-download mr-1"></i>ZIP 다운로드
                            </button>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                            ${orderData.images.map((imgData, index) => `
                                <div class="text-center bg-gray-50 p-2 rounded-lg">
                                    <img src="${imgData.url}" alt="${imgData.name}" class="w-full h-20 object-cover rounded border cursor-pointer" onclick="downloadSingleImage(${index})">
                                    <p class="text-xs text-gray-500 mt-1 truncate">${imgData.name}</p>
                                    <p class="text-xs text-gray-400">${formatFileSize(imgData.file.size)}</p>
                                    <button onclick="downloadSingleImage(${index})" class="bg-blue-500 text-white px-2 py-1 rounded text-xs mt-1 hover:bg-blue-600 transition-colors">
                                        <i class="fas fa-download mr-1"></i>다운로드
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                        <p class="text-sm text-indigo-600 mt-3">💡 개별 이미지를 클릭하거나 다운로드 버튼을 눌러 저장하세요.</p>
                    </div>
                `;
            } else {
                previewContainer.innerHTML = `
                    <div class="mb-4 p-4 bg-gray-50 rounded-lg">
                        <p class="text-gray-500">업로드된 이미지가 없습니다.</p>
                    </div>
                `;
            }
        }

        // 모달 닫기
        function closeModal() {
            const modal = document.getElementById('resultModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex', 'modal-enter');
        }

        // 링크 복사 기능
        function sendToKakao() {
            // 주문 데이터를 Base64로 인코딩하여 URL에 포함
            const encodedData = encodeOrderDataToURL();
            const shareUrl = `${window.location.origin}${window.location.pathname}#data=${encodedData}`;
            
            // 링크를 클립보드에 복사
            copyLinkToClipboard(shareUrl);
        }
        
        // 주문 데이터를 URL에 인코딩
        function encodeOrderDataToURL() {
            const dataToEncode = {
                brandName: orderData.brandName || '',
                concept: orderData.concept || '',
                gender: orderData.gender || '',
                race: orderData.race || '',
                locations: orderData.locations || [],
                customLocation: orderData.customLocation || '',
                contact: orderData.contact || '',
                additionalRequest: orderData.additionalRequest || '',
                images: (orderData.images && orderData.images.length > 0) ? 
                    orderData.images.map(img => ({
                        name: img.name,
                        url: img.url,
                        size: img.file.size
                    })) : [],
                timestamp: orderData.timestamp || new Date().toLocaleString('ko-KR')
            };
            
            console.log('인코딩할 데이터:', dataToEncode);
            
            // JSON을 문자열로 변환 후 Base64로 인코딩
            const jsonString = JSON.stringify(dataToEncode);
            return btoa(encodeURIComponent(jsonString));
        }
        

        


        // 모바일 기기 감지
        function isMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }



        // 공유된 데이터 확인 및 표시
        function checkForSharedData() {
            const hash = window.location.hash;
            if (hash.startsWith('#data=')) {
                const encodedData = hash.substring(6);
                try {
                    const jsonString = decodeURIComponent(atob(encodedData));
                    const sharedData = JSON.parse(jsonString);
                    displaySharedOrderData(sharedData);
                } catch (error) {
                    console.error('공유 데이터 디코딩 오류:', error);
                }
            }
        }
        
        // 공유된 주문 데이터 표시
        function displaySharedOrderData(data) {
            // 폼을 숨기고 공유 데이터 표시 영역 생성
            document.querySelector('.bg-white.rounded-2xl').style.display = 'none';
            
            const sharedContainer = document.createElement('div');
            sharedContainer.className = 'bg-white rounded-2xl shadow-xl overflow-hidden';
            sharedContainer.innerHTML = `
                <div class="bg-gradient-to-r from-green-500 to-teal-600 px-8 py-6">
                    <h2 class="text-2xl font-bold text-white flex items-center">
                        <i class="fas fa-file-alt mr-3"></i>
                        공유된 작업지시서
                    </h2>
                    <p class="text-green-100 mt-2">작업지시서 정보와 첨부된 이미지를 확인하고 다운로드하세요</p>
                </div>
                
                <div class="p-8">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-700 mb-4">📋 기본 정보</h3>
                            <div class="space-y-2">
                                <p><strong>브랜드명:</strong> ${data.brandName}</p>
                                <p><strong>모델:</strong> ${data.gender} / ${data.race}</p>
                                <p><strong>연락처:</strong> ${data.contact}</p>
                                <p><strong>작성일시:</strong> ${data.timestamp}</p>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-semibold text-gray-700 mb-4">📍 촬영 정보</h3>
                            <div class="space-y-2">
                                <p><strong>촬영 장소:</strong> ${data.locations ? data.locations.join(', ') : '-'}${data.customLocation ? ` (${data.customLocation})` : ''}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-700 mb-2">💡 제작 컨셉</h3>
                        <p class="bg-gray-50 p-4 rounded-lg">${data.concept}</p>
                    </div>
                    
                    ${data.additionalRequest ? `
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-700 mb-2">💬 추가 요청사항</h3>
                            <p class="bg-gray-50 p-4 rounded-lg">${data.additionalRequest}</p>
                        </div>
                    ` : ''}
                    
                    ${data.images && data.images.length > 0 ? `
                        <div class="mb-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold text-gray-700">📸 첨부된 상품사진 (${data.images.length}장)</h3>
                                <button onclick="downloadAllSharedImages()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                                    <i class="fas fa-download mr-2"></i>전체 다운로드
                                </button>
                            </div>
                            <div id="sharedImageGrid" class="grid grid-cols-2 md:grid-cols-3 gap-4">
                                ${data.images.map((img, index) => `
                                    <div class="bg-gray-50 p-3 rounded-lg text-center">
                                        <img src="${img.url}" alt="${img.name}" class="w-full h-24 object-cover rounded mb-2">
                                        <p class="text-xs text-gray-600 mb-2">${img.name}</p>
                                        <button onclick="downloadSharedImage(${index})" class="bg-blue-500 text-white px-2 py-1 rounded text-xs hover:bg-blue-600 transition-colors">
                                            <i class="fas fa-download mr-1"></i>다운로드
                                        </button>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="text-center pt-6 border-t">
                        <button onclick="location.reload()" class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition-colors">
                            <i class="fas fa-plus mr-2"></i>새 작업지시서 작성하기
                        </button>
                    </div>
                </div>
            `;
            
            // 기존 폼 컨테이너 뒤에 추가
            document.querySelector('.container > .bg-white').parentNode.appendChild(sharedContainer);
            
            // 전역 변수에 공유 데이터 저장
            window.sharedOrderData = data;
        }
        
        // 개별 이미지 다운로드
        function downloadSharedImage(index) {
            const imageData = window.sharedOrderData.images[index];
            if (imageData) {
                const link = document.createElement('a');
                link.href = imageData.url;
                link.download = imageData.name;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }
        
        // 모든 이미지 다운로드 (ZIP 없이 개별 다운로드)
        function downloadAllSharedImages() {
            if (window.sharedOrderData && window.sharedOrderData.images) {
                window.sharedOrderData.images.forEach((imageData, index) => {
                    setTimeout(() => {
                        downloadSharedImage(index);
                    }, index * 300); // 300ms 간격으로 다운로드
                });
                alert(`${window.sharedOrderData.images.length}장의 이미지 다운로드가 시작되었습니다!`);
            }
        }
        
        // 링크 복사 전용 함수
        function copyLinkToClipboard(url) {
            navigator.clipboard.writeText(url).then(() => {
                alert('링크가 복사되었습니다. 카카오톡으로 링크를 보내주세요.');
            }).catch(() => {
                // 폴백: 텍스트 선택
                const textArea = document.createElement('textarea');
                textArea.value = url;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('링크가 복사되었습니다. 카카오톡으로 링크를 보내주세요.');
            });
        }
        
        // 클립보드에 복사 (기존 함수 유지)
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('📋 링크가 클립보드에 복사되었습니다!\n\n💡 카카오톡을 열어서 원하는 대화방에 붙여넣기 해주세요.');
            }).catch(() => {
                // 폴백: 텍스트 선택
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('📋 링크가 복사되었습니다!\n\n💡 카카오톡을 열어서 원하는 대화방에 붙여넣기 해주세요.');
            });
        }






    </script>
</body>
</html><!-- Updated Thu Sep 18 05:12:59 UTC 2025 -->
<!-- Updated 2025-09-18 06:18:39 UTC -->
