<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>끈스튜디오 - AI 피팅 촬영 작업지시서</title>
    <meta name="cache-bust" content="2025091815">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <!-- 카카오톡 SDK -->
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.2/kakao.min.js" integrity="sha384-TiCUE00h649CAMonG018J2ujOgDKW/kVWlChEuu4jK2vxfAAD0eZxzCKakxg55G4" crossorigin="anonymous"></script>
    <!-- JSZip for creating ZIP files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <style>
        /* 커스텀 CSS */
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }

        .font-noto {
            font-family: 'Noto Sans KR', sans-serif;
        }

        /* 라디오 버튼 및 체크박스 스타일링 */
        .gender-option:has(input:checked),
        .race-option:has(input:checked),
        .location-option:has(input:checked) {
            @apply border-indigo-500 bg-indigo-50;
        }

        .gender-option:has(input:checked) i,
        .race-option:has(input:checked) span,
        .location-option:has(input:checked) span {
            @apply text-indigo-600;
        }

        /* 파일 업로드 영역 호버 효과 */
        .file-upload-area:hover {
            @apply border-indigo-400 bg-indigo-50;
        }

        /* 이미지 미리보기 스타일 - 개선된 크기와 가시성 */
        .image-preview-item {
            @apply relative rounded-lg overflow-hidden shadow-lg border-2 border-gray-200 bg-white;
            transition: all 0.2s ease;
        }
        
        .image-preview-item:hover {
            @apply border-indigo-300 shadow-xl transform scale-105;
        }

        .image-preview-item img {
            @apply w-full h-32 md:h-40 object-cover;
        }

        .image-preview-item .remove-btn {
            @apply absolute top-2 right-2 bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm cursor-pointer hover:bg-red-600 shadow-lg;
            transition: all 0.2s ease;
        }
        
        .image-preview-item .remove-btn:hover {
            @apply transform scale-110;
        }

        /* 폼 애니메이션 */
        .form-group {
            @apply transform transition-all duration-200;
        }

        .form-group:hover {
            @apply translate-y-[-2px];
        }

        /* 버튼 애니메이션 */
        button {
            @apply transition-all duration-200;
        }

        /* 모달 애니메이션 */
        .modal-enter {
            animation: modalFadeIn 0.3s ease-out;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* 스크롤바 커스터마이징 */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* 반응형 디자인 개선 */
        @media (max-width: 768px) {
            .container {
                @apply px-2;
            }
            
            .form-group label {
                @apply text-xs;
            }
            
            .gender-option,
            .race-option,
            .location-option {
                @apply p-2 text-sm;
            }
            
            .gender-option i {
                @apply text-xl mb-1;
            }
            
            /* 모바일에서 그리드 조정 */
            .grid.grid-cols-3 {
                @apply grid-cols-1;
            }
            
            .grid.grid-cols-2.md\\:grid-cols-4 {
                @apply grid-cols-2;
            }
            
            .grid.grid-cols-2.md\\:grid-cols-3 {
                @apply grid-cols-2;
            }
            
            /* 이미지 미리보기 모바일 최적화 */
            .grid.grid-cols-1.md\\:grid-cols-2.lg\\:grid-cols-3 {
                @apply grid-cols-1 gap-4;
            }
            
            /* 모바일 텍스트 크기 조정 */
            h1 {
                @apply text-2xl;
            }
            
            h2 {
                @apply text-xl;
            }
            
            /* 모바일 버튼 크기 조정 */
            button[type="submit"] {
                @apply py-3;
            }
            
            button[type="submit"] span {
                @apply text-xs leading-tight;
            }
            
            /* 모바일 입력 필드 조정 */
            input, textarea, select {
                @apply text-base py-2;
            }
            
            /* 모바일 모달 조정 */
            #resultModal > div {
                @apply mx-2 max-w-sm;
            }
        }

        @media (max-width: 480px) {
            /* 초소형 화면 대응 */
            .gender-option,
            .race-option,
            .location-option {
                @apply p-1 text-xs;
            }
            
            .gender-option i {
                @apply text-lg;
            }
            
            .grid.grid-cols-2 {
                @apply grid-cols-1;
            }
            
            /* 헤더 아이콘 크기 조정 */
            .fa-camera-retro {
                @apply text-4xl;
            }
            
            /* 폼 패딩 조정 */
            .bg-white.rounded-2xl > form {
                @apply p-4;
            }
            
            .bg-gradient-to-r.from-indigo-500 {
                @apply px-4 py-4;
            }
        }

        /* 테블릿 최적화 */
        @media (min-width: 768px) and (max-width: 1024px) {
            .container {
                @apply px-4;
            }
            
            .grid.grid-cols-2.md\\:grid-cols-4 {
                @apply grid-cols-3;
            }
        }

        /* 체크 표시 애니메이션 */
        .check-animation {
            animation: checkBounce 0.6s ease-in-out;
        }

        @keyframes checkBounce {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* 로딩 스피너 */
        .loading-spinner {
            @apply animate-spin rounded-full h-8 w-8 border-b-2 border-white;
        }

        /* 그래디언트 텍스트 */
        .gradient-text {
            background: linear-gradient(45deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* 카드 호버 효과 */
        .card-hover {
            @apply transition-all duration-300 hover:shadow-2xl hover:-translate-y-1;
        }

        /* 스타일 보완 - 선택된 옵션 스타일 */
        .gender-option.selected,
        .race-option.selected,
        .location-option.selected {
            border-color: #6366f1 !important;
            background-color: #eef2ff !important;
        }

        .gender-option.selected i,
        .race-option.selected span,
        .location-option.selected span {
            color: #6366f1 !important;
        }

        /* 모달 스크롤 최적화 */
        .max-h-90vh {
            max-height: 90vh;
        }
        
        /* 이미지 미리보기 그리드 개선 */
        #modalImagePreview img {
            transition: transform 0.2s ease;
        }
        
        #modalImagePreview img:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-indigo-100 min-h-screen font-noto">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- 헤더 -->
        <div class="text-center mb-8">
            <div class="mb-4">
                <i class="fas fa-camera-retro text-6xl text-indigo-600 mb-4"></i>
            </div>
            <h1 class="text-4xl font-bold text-gray-800 mb-2">끈스튜디오</h1>
            <p class="text-xl text-gray-600 mb-1">AI 피팅 촬영 서비스</p>
            <p class="text-sm text-gray-500">@kkeunstudio</p>
        </div>

        <!-- 작업지시서 폼 -->
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
            <div class="bg-gradient-to-r from-indigo-500 to-purple-600 px-8 py-6">
                <h2 class="text-2xl font-bold text-white flex items-center">
                    <i class="fas fa-clipboard-list mr-3"></i>
                    작업지시서
                </h2>
                <p class="text-indigo-100 mt-2">원하시는 AI 피팅 촬영을 위해 아래 정보를 입력해 주세요</p>
            </div>

            <form id="orderForm" class="p-8 space-y-6">
                <!-- 브랜드명 -->
                <div class="form-group">
                    <label for="brandName" class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-tag mr-2 text-indigo-500"></i>브랜드명 *
                    </label>
                    <input type="text" id="brandName" name="brandName" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors"
                           placeholder="예: 끈스튜디오">
                </div>

                <!-- 제작 컨셉 -->
                <div class="form-group">
                    <label for="concept" class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-lightbulb mr-2 text-indigo-500"></i>제작하고 싶은 컨셉 *
                    </label>
                    <textarea id="concept" name="concept" required rows="3"
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors"
                              placeholder="예: 캐주얼한 일상룩, 고급스러운 오피스룩, 트렌디한 스트릿패션 등"></textarea>
                </div>

                <!-- 모델 성별 -->
                <div class="form-group">
                    <label class="block text-sm font-semibold text-gray-700 mb-3">
                        <i class="fas fa-users mr-2 text-indigo-500"></i>모델 성별 *
                    </label>
                    <div class="grid grid-cols-3 gap-4">
                        <label class="flex items-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors gender-option">
                            <input type="radio" name="gender" value="여성" class="sr-only">
                            <div class="flex flex-col items-center w-full">
                                <i class="fas fa-female text-2xl text-pink-500 mb-2"></i>
                                <span class="font-medium">여성</span>
                            </div>
                        </label>
                        <label class="flex items-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors gender-option">
                            <input type="radio" name="gender" value="남성" class="sr-only">
                            <div class="flex flex-col items-center w-full">
                                <i class="fas fa-male text-2xl text-blue-500 mb-2"></i>
                                <span class="font-medium">남성</span>
                            </div>
                        </label>
                        <label class="flex items-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors gender-option">
                            <input type="radio" name="gender" value="무관" class="sr-only">
                            <div class="flex flex-col items-center w-full">
                                <i class="fas fa-genderless text-2xl text-gray-500 mb-2"></i>
                                <span class="font-medium">무관</span>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- 모델 인종 -->
                <div class="form-group">
                    <label class="block text-sm font-semibold text-gray-700 mb-3">
                        <i class="fas fa-globe mr-2 text-indigo-500"></i>모델 인종 *
                    </label>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors race-option">
                            <input type="radio" name="race" value="동양인" class="sr-only">
                            <span class="font-medium text-center w-full">동양인</span>
                        </label>
                        <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors race-option">
                            <input type="radio" name="race" value="백인" class="sr-only">
                            <span class="font-medium text-center w-full">백인</span>
                        </label>
                        <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors race-option">
                            <input type="radio" name="race" value="흑인" class="sr-only">
                            <span class="font-medium text-center w-full">흑인</span>
                        </label>
                        <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors race-option">
                            <input type="radio" name="race" value="무관" class="sr-only">
                            <span class="font-medium text-center w-full">무관</span>
                        </label>
                    </div>
                </div>

                <!-- 촬영 장소/배경 -->
                <div class="form-group">
                    <label class="block text-sm font-semibold text-gray-700 mb-3">
                        <i class="fas fa-map-marker-alt mr-2 text-indigo-500"></i>촬영 장소/배경
                    </label>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                        <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors location-option">
                            <input type="checkbox" name="location" value="스튜디오" class="sr-only">
                            <span class="font-medium text-center w-full">스튜디오</span>
                        </label>
                        <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors location-option">
                            <input type="checkbox" name="location" value="야외" class="sr-only">
                            <span class="font-medium text-center w-full">야외</span>
                        </label>
                        <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors location-option">
                            <input type="checkbox" name="location" value="카페" class="sr-only">
                            <span class="font-medium text-center w-full">카페</span>
                        </label>
                        <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors location-option">
                            <input type="checkbox" name="location" value="거리" class="sr-only">
                            <span class="font-medium text-center w-full">거리</span>
                        </label>
                        <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors location-option">
                            <input type="checkbox" name="location" value="사무실" class="sr-only">
                            <span class="font-medium text-center w-full">사무실</span>
                        </label>
                        <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-indigo-300 transition-colors location-option">
                            <input type="checkbox" name="location" value="기타" class="sr-only">
                            <span class="font-medium text-center w-full">기타</span>
                        </label>
                    </div>
                    <input type="text" id="customLocation" name="customLocation" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors mt-3 hidden"
                           placeholder="원하시는 장소를 직접 입력해 주세요">
                </div>

                <!-- 상품 사진 업로드 -->
                <div class="form-group">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-camera mr-2 text-indigo-500"></i>상품 사진 (착용컷 권장) *
                    </label>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-indigo-400 transition-colors">
                        <input type="file" id="productImages" name="productImages" multiple accept="image/*" class="hidden">
                        <label for="productImages" class="cursor-pointer">
                            <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                            <p class="text-gray-600 font-medium mb-2">클릭하여 이미지 업로드</p>
                            <p class="text-sm text-gray-400">PNG, JPG, JPEG 파일을 선택해 주세요 (최대 10MB)</p>
                        </label>
                    </div>
                    <div id="imagePreview" class="mt-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 hidden"></div>
                </div>

                <!-- 연락처 -->
                <div class="form-group">
                    <label for="contact" class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-phone mr-2 text-indigo-500"></i>연락처 *
                    </label>
                    <input type="text" id="contact" name="contact" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors"
                           placeholder="010-0000-0000">
                </div>

                <!-- 추가 요청사항 -->
                <div class="form-group">
                    <label for="additionalRequest" class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-comment-dots mr-2 text-indigo-500"></i>추가 요청사항
                    </label>
                    <textarea id="additionalRequest" name="additionalRequest" rows="3"
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors"
                              placeholder="특별한 포즈나 분위기, 기타 요청사항을 입력해 주세요"></textarea>
                </div>

                <!-- 제출 버튼 -->
                <div class="pt-6 space-y-3">
                    <button type="submit" 
                            id="submitButton"
                            onclick="console.log('버튼 클릭 - onclick 이벤트'); handleFormSubmitDirect(event);"
                            class="w-full bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-semibold py-4 px-4 rounded-lg hover:from-indigo-600 hover:to-purple-700 transform hover:scale-105 transition-all duration-200 shadow-lg">
                        <i class="fas fa-download mr-2"></i>
                        <span class="text-sm md:text-base">작업지시서 다운로드 (다운로드 후 카카오톡으로 보내주세요)</span>
                    </button>
                </div>
            </form>
        </div>

        <!-- 간단한 알림 메시지용 모달 (필요시) -->
        <div id="notificationModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white rounded-2xl p-8 max-w-md mx-4 text-center">
                <i id="notificationIcon" class="fas fa-check-circle text-5xl text-green-500 mb-4"></i>
                <h3 id="notificationTitle" class="text-2xl font-bold text-gray-800 mb-4">알림</h3>
                <p id="notificationMessage" class="text-gray-600 mb-4">메시지</p>
                
                <button id="closeNotification" 
                        class="w-full bg-indigo-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-indigo-600 transition-colors">
                    확인
                </button>
            </div>
        </div>

        <!-- 푸터 -->
        <div class="text-center mt-8 text-gray-500">
            <p class="text-sm">© 2024 끈스튜디오 | AI 피팅 촬영 서비스</p>
            <p class="text-xs mt-1">카카오톡 채널: @kkeunstudio</p>
            <div class="mt-4">
                <a href="admin.html" class="text-xs text-gray-400 hover:text-gray-600 transition-colors">
                    <i class="fas fa-cog mr-1"></i>관리자 페이지
                </a>
            </div>
        </div>
    </div>

    <script>
        // 전역 변수
        let orderData = {};
        let uploadedImages = [];

        // DOM 로드 완료 시 실행
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM 로드 완료');
            initializeApp();
            checkForSharedData();
        });

        // 백업: 윈도우 로드 완료 시에도 실행 (DOMContentLoaded가 실행되지 않는 경우를 대비)
        window.addEventListener('load', function() {
            console.log('윈도우 로드 완료');
            
            // 폼이 이미 초기화되지 않았다면 다시 시도
            const orderForm = document.getElementById('orderForm');
            if (orderForm && !orderForm.dataset.initialized) {
                console.log('폼 재초기화 시도');
                setupEventListeners();
                orderForm.dataset.initialized = 'true';
            }
        });

        // 앱 초기화
        function initializeApp() {
            console.log('앱 초기화 시작');
            
            // 카카오톡 SDK 초기화
            if (typeof Kakao !== 'undefined') {
                Kakao.init('YOUR_KAKAO_APP_KEY'); // 실제 사용시에는 카카오 개발자센터에서 발급받은 앱 키를 사용하세요
                console.log('카카오톡 SDK 초기화 완료:', Kakao.isInitialized());
            } else {
                console.log('카카오톡 SDK 로드되지 않음');
            }
            
            setupEventListeners();
            setupFormValidation();
            setupImageUpload();
            setupCustomOptions();
            setupPhoneNumberFormatting();
            
            console.log('앱 초기화 완료');
        }

        // 이벤트 리스너 설정
        function setupEventListeners() {
            console.log('이벤트 리스너 설정 시작');
            
            // 폼 제출
            const orderForm = document.getElementById('orderForm');
            console.log('orderForm 요소:', orderForm);
            
            if (orderForm) {
                orderForm.addEventListener('submit', handleFormSubmit);
                orderForm.dataset.initialized = 'true';
                console.log('폼 제출 이벤트 리스너 추가 완료');
                
                // 추가 디버깅: 직접 버튼 클릭 이벤트도 추가
                const submitButton = orderForm.querySelector('button[type="submit"]');
                console.log('제출 버튼:', submitButton);
                
                if (submitButton) {
                    submitButton.addEventListener('click', function(e) {
                        console.log('버튼 클릭됨 - 이벤트 타입:', e.type);
                        // 폼 제출은 handleFormSubmit에서 처리됨
                    });
                }
            } else {
                console.error('orderForm을 찾을 수 없습니다!');
            }
            
            // 알림 모달 관련
            const closeNotificationBtn = document.getElementById('closeNotification');
            
            if (closeNotificationBtn) {
                closeNotificationBtn.addEventListener('click', closeNotification);
                console.log('알림 모달 이벤트 리스너 추가 완료');
            }
            
            // 라디오 버튼 및 체크박스 스타일링
            setupOptionSelections();
        }

        // 옵션 선택 스타일링 설정
        function setupOptionSelections() {
            // 성별 선택
            document.querySelectorAll('input[name="gender"]').forEach(input => {
                input.addEventListener('change', function() {
                    document.querySelectorAll('.gender-option').forEach(option => {
                        option.classList.remove('selected', 'border-indigo-500', 'bg-indigo-50');
                    });
                    if (this.checked) {
                        this.closest('.gender-option').classList.add('selected', 'border-indigo-500', 'bg-indigo-50');
                    }
                });
            });
            
            // 인종 선택
            document.querySelectorAll('input[name="race"]').forEach(input => {
                input.addEventListener('change', function() {
                    document.querySelectorAll('.race-option').forEach(option => {
                        option.classList.remove('selected', 'border-indigo-500', 'bg-indigo-50');
                    });
                    if (this.checked) {
                        this.closest('.race-option').classList.add('selected', 'border-indigo-500', 'bg-indigo-50');
                    }
                });
            });
            
            // 장소 선택 (다중 선택)
            document.querySelectorAll('input[name="location"]').forEach(input => {
                input.addEventListener('change', function() {
                    const option = this.closest('.location-option');
                    if (this.checked) {
                        option.classList.add('selected', 'border-indigo-500', 'bg-indigo-50');
                        // "기타" 선택 시 입력 필드 표시
                        if (this.value === '기타') {
                            document.getElementById('customLocation').classList.remove('hidden');
                        }
                    } else {
                        option.classList.remove('selected', 'border-indigo-500', 'bg-indigo-50');
                        // "기타" 해제 시 입력 필드 숨김
                        if (this.value === '기타') {
                            document.getElementById('customLocation').classList.add('hidden');
                            document.getElementById('customLocation').value = '';
                        }
                    }
                });
            });
        }

        // 커스텀 옵션 설정
        function setupCustomOptions() {
            // 기타 장소 입력 필드 처리는 위에서 이미 구현됨
        }

        // 전화번호 자동 포매팅 설정
        function setupPhoneNumberFormatting() {
            const contactInput = document.getElementById('contact');
            
            if (contactInput) {
                contactInput.addEventListener('input', function(e) {
                    formatPhoneNumber(e.target);
                });
                
                contactInput.addEventListener('keydown', function(e) {
                    // 백스페이스, 삭제, 탭, 이스케이프, 엔터, 화살표 키는 허용
                    if ([8, 9, 27, 13, 46, 37, 38, 39, 40].indexOf(e.keyCode) !== -1 ||
                        // Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X 허용
                        (e.keyCode === 65 && (e.ctrlKey || e.metaKey)) ||
                        (e.keyCode === 67 && (e.ctrlKey || e.metaKey)) ||
                        (e.keyCode === 86 && (e.ctrlKey || e.metaKey)) ||
                        (e.keyCode === 88 && (e.ctrlKey || e.metaKey))) {
                        return;
                    }
                    
                    // 숫자가 아닌 키는 차단
                    if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                        e.preventDefault();
                    }
                });
                
                console.log('전화번호 자동 포매팅 설정 완료');
            }
        }

        // 전화번호 포매팅 함수
        function formatPhoneNumber(input) {
            // 숫자만 추출
            let value = input.value.replace(/\D/g, '');
            
            // 11자리를 초과하지 않도록 제한
            if (value.length > 11) {
                value = value.slice(0, 11);
            }
            
            // 포매팅 적용
            let formattedValue = '';
            
            if (value.length > 0) {
                if (value.length <= 3) {
                    // 010
                    formattedValue = value;
                } else if (value.length <= 7) {
                    // 010-1234
                    formattedValue = value.slice(0, 3) + '-' + value.slice(3);
                } else {
                    // 010-1234-5678
                    formattedValue = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7);
                }
            }
            
            // 입력 필드에 포매팅된 값 설정
            input.value = formattedValue;
        }

        // 이미지 업로드 설정
        function setupImageUpload() {
            const fileInput = document.getElementById('productImages');
            const preview = document.getElementById('imagePreview');
            
            fileInput.addEventListener('change', function(e) {
                handleImageUpload(e.target.files);
            });
            
            // 드래그 앤 드롭 기능
            const uploadArea = fileInput.parentElement;
            
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.classList.add('border-indigo-400', 'bg-indigo-50');
            });
            
            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('border-indigo-400', 'bg-indigo-50');
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('border-indigo-400', 'bg-indigo-50');
                handleImageUpload(e.dataTransfer.files);
            });
        }

        // 이미지 업로드 처리
        function handleImageUpload(files) {
            const preview = document.getElementById('imagePreview');
            const maxFiles = 10;
            const maxSize = 10 * 1024 * 1024; // 10MB
            
            // 파일 수 제한
            if (uploadedImages.length + files.length > maxFiles) {
                alert(`최대 ${maxFiles}개의 이미지만 업로드할 수 있습니다.`);
                return;
            }
            
            Array.from(files).forEach(file => {
                // 파일 크기 제한
                if (file.size > maxSize) {
                    alert(`${file.name} 파일이 너무 큽니다. 10MB 이하의 파일을 선택해 주세요.`);
                    return;
                }
                
                // 이미지 파일 타입 검사
                if (!file.type.startsWith('image/')) {
                    alert(`${file.name}은(는) 이미지 파일이 아닙니다.`);
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageData = {
                        file: file,
                        url: e.target.result,
                        name: file.name
                    };
                    
                    uploadedImages.push(imageData);
                    addImagePreview(imageData, uploadedImages.length - 1);
                    
                    // 미리보기 영역 표시
                    preview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            });
        }

        // 이미지 미리보기 추가 - 개선된 크기와 가시성
        function addImagePreview(imageData, index) {
            const preview = document.getElementById('imagePreview');
            const div = document.createElement('div');
            div.className = 'image-preview-item relative';
            div.innerHTML = `
                <div class="relative">
                    <img src="${imageData.url}" alt="${imageData.name}" class="w-full h-32 md:h-40 object-cover rounded-lg cursor-pointer" onclick="viewFullImage('${imageData.url}', '${imageData.name}')">
                    <button type="button" class="remove-btn absolute top-2 right-2 bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm cursor-pointer hover:bg-red-600 shadow-lg" onclick="removeImage(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="p-3">
                    <p class="text-sm font-medium text-gray-700 truncate">${imageData.name}</p>
                    <p class="text-xs text-gray-500 mt-1">${formatFileSize(imageData.file.size)}</p>
                    <div class="text-xs text-indigo-600 mt-1">
                        <i class="fas fa-eye mr-1"></i>클릭하여 크게 보기
                    </div>
                </div>
            `;
            preview.appendChild(div);
        }

        // 이미지 제거
        function removeImage(index) {
            uploadedImages.splice(index, 1);
            const preview = document.getElementById('imagePreview');
            preview.innerHTML = '';
            
            // 다시 렌더링
            uploadedImages.forEach((imageData, i) => {
                addImagePreview(imageData, i);
            });
            
            // 이미지가 없으면 미리보기 영역 숨김
            if (uploadedImages.length === 0) {
                preview.classList.add('hidden');
            }
        }

        // 폼 유효성 검사 설정
        function setupFormValidation() {
            const form = document.getElementById('orderForm');
            const inputs = form.querySelectorAll('input[required], textarea[required]');
            
            inputs.forEach(input => {
                input.addEventListener('blur', validateField);
                input.addEventListener('input', clearFieldError);
            });
        }

        // 필드 유효성 검사
        function validateField(e) {
            const field = e.target;
            const value = field.value.trim();
            
            // 기존 에러 메시지 제거
            clearFieldError(e);
            
            if (!value) {
                showFieldError(field, '이 필드는 필수입니다.');
                return false;
            }
            
            // 연락처 형식 검사
            if (field.name === 'contact') {
                const phoneRegex = /^010-\d{4}-\d{4}$/;
                if (!phoneRegex.test(value)) {
                    showFieldError(field, '올바른 휴대폰 번호를 입력해 주세요. (예: 010-1234-5678)');
                    return false;
                }
            }
            
            return true;
        }

        // 필드 에러 표시
        function showFieldError(field, message) {
            field.classList.add('border-red-500');
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'text-red-500 text-sm mt-1 error-message';
            errorDiv.textContent = message;
            
            field.parentElement.appendChild(errorDiv);
        }

        // 필드 에러 제거
        function clearFieldError(e) {
            const field = e.target;
            field.classList.remove('border-red-500');
            
            const errorMessage = field.parentElement.querySelector('.error-message');
            if (errorMessage) {
                errorMessage.remove();
            }
        }

        // 폼 제출 처리 (메인)
        function handleFormSubmit(e) {
            e.preventDefault();
            console.log('폼 제출 이벤트 발생 (addEventListener)');
            processFormSubmission();
        }

        // 폼 제출 처리 (백업 - onclick에서 호출)
        function handleFormSubmitDirect(e) {
            e.preventDefault();
            console.log('폼 제출 이벤트 발생 (onclick)');
            processFormSubmission();
        }

        // 실제 폼 처리 로직 - 바로 ZIP 다운로드
        function processFormSubmission() {
            console.log('processFormSubmission 함수 시작');
            
            try {
                if (!validateForm()) {
                    console.log('폼 유효성 검사 실패');
                    return;
                }
                
                console.log('폼 유효성 검사 통과');
                
                // 로딩 표시
                console.log('로딩 표시 시작');
                showLoading();
                
                // 폼 데이터 수집
                console.log('폼 데이터 수집 시작');
                collectFormData();
                
                // 바로 ZIP 다운로드 시작
                console.log('ZIP 다운로드 시작');
                setTimeout(() => {
                    console.log('ZIP 다운로드 실행');
                    hideLoading();
                    downloadAllAsZipDirect();
                    console.log('ZIP 다운로드 완료');
                }, 1000);
                
            } catch (error) {
                console.error('processFormSubmission 오류:', error);
                hideLoading();
                alert('오류가 발생했습니다: ' + error.message);
            }
        }

        // 전체 폼 유효성 검사
        function validateForm() {
            const form = document.getElementById('orderForm');
            let isValid = true;
            
            console.log('유효성 검사 시작');
            
            try {
                // 필수 필드 검사 - 브랜드명과 컨셉만 체크
                const brandName = document.getElementById('brandName').value.trim();
                const concept = document.getElementById('concept').value.trim();
                const contact = document.getElementById('contact').value.trim();
                
                console.log('입력값 확인:', { brandName, concept, contact });
                
                if (!brandName) {
                    console.log('브랜드명 누락');
                    alert('브랜드명을 입력해 주세요.');
                    isValid = false;
                }
                
                if (!concept) {
                    console.log('컨셉 누락');
                    alert('제작 컨셉을 입력해 주세요.');
                    isValid = false;
                }
                
                if (!contact) {
                    console.log('연락처 누락');
                    alert('연락처를 입력해 주세요.');
                    isValid = false;
                }
                
                // 성별 선택 검사
                const genderSelected = form.querySelector('input[name="gender"]:checked');
                console.log('선택된 성별:', genderSelected ? genderSelected.value : '없음');
                if (!genderSelected) {
                    console.log('성별 선택 누락');
                    alert('모델 성별을 선택해 주세요.');
                    isValid = false;
                }
                
                // 인종 선택 검사
                const raceSelected = form.querySelector('input[name="race"]:checked');
                console.log('선택된 인종:', raceSelected ? raceSelected.value : '없음');
                if (!raceSelected) {
                    console.log('인종 선택 누락');
                    alert('모델 인종을 선택해 주세요.');
                    isValid = false;
                }
                
                // 이미지 업로드는 선택사항으로 변경
                console.log('유효성 검사 결과:', isValid);
                
                return isValid;
                
            } catch (error) {
                console.error('유효성 검사 오류:', error);
                alert('유효성 검사 중 오류가 발생했습니다: ' + error.message);
                return false;
            }
        }

        // 폼 데이터 수집
        function collectFormData() {
            const form = document.getElementById('orderForm');
            const formData = new FormData(form);
            
            console.log('데이터 수집 시작');
            
            orderData = {
                brandName: formData.get('brandName') || '',
                concept: formData.get('concept') || '',
                gender: formData.get('gender') || '',
                race: formData.get('race') || '',
                locations: getSelectedLocations(),
                customLocation: formData.get('customLocation') || '',
                contact: formData.get('contact') || '',
                additionalRequest: formData.get('additionalRequest') || '',
                images: uploadedImages || [],
                timestamp: new Date().toLocaleString('ko-KR')
            };
            
            console.log('수집된 데이터:', orderData);
        }

        // 선택된 장소 가져오기
        function getSelectedLocations() {
            const locations = [];
            document.querySelectorAll('input[name="location"]:checked').forEach(input => {
                locations.push(input.value);
            });
            return locations;
        }

        // 로딩 표시
        function showLoading() {
            const button = document.querySelector('button[type="submit"]');
            const originalText = button.innerHTML;
            button.innerHTML = '<div class="loading-spinner mx-auto"></div>';
            button.disabled = true;
            button.dataset.originalText = originalText;
        }

        // 로딩 숨김
        function hideLoading() {
            const button = document.querySelector('button[type="submit"]');
            button.innerHTML = button.dataset.originalText;
            button.disabled = false;
        }

        // 결과 모달 표시
        function showResultModal() {
            const modal = document.getElementById('resultModal');
            
            // 업로드된 이미지들을 모달에 미리보기로 표시
            displayModalImagePreview();
            
            modal.classList.remove('hidden');
            modal.classList.add('flex', 'modal-enter');
            
            // 체크 아이콘 애니메이션
            setTimeout(() => {
                const checkIcon = modal.querySelector('.fa-check-circle');
                checkIcon.classList.add('check-animation');
            }, 100);
        }

        // 모달에 이미지 미리보기 표시 (기존 모달에 추가될 내용)
        function displayModalImagePreview() {
            // 모달 내용에 이미지 미리보기 영역 추가
            const modal = document.getElementById('resultModal');
            const modalContent = modal.querySelector('div > div');
            
            let imagePreviewHtml = '';
            
            if (orderData.images && orderData.images.length > 0) {
                imagePreviewHtml = `
                    <div class="mb-6 p-4 bg-gray-50 rounded-lg" id="modalImagePreview">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-lg font-semibold text-gray-700">📸 업로드된 상품사진 (${orderData.images.length}장)</h4>
                            <button onclick="downloadImagesOnlyAsZip()" class="bg-purple-500 text-white px-3 py-1 rounded text-sm hover:bg-purple-600 transition-colors">
                                <i class="fas fa-images mr-1"></i>이미지만 ZIP
                            </button>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                            ${orderData.images.map((imgData, index) => `
                                <div class="text-center bg-white p-2 rounded border">
                                    <img src="${imgData.url}" alt="${imgData.name}" class="w-full h-16 object-cover rounded cursor-pointer" onclick="downloadSingleImage(${index})">
                                    <p class="text-xs text-gray-500 mt-1 truncate">${imgData.name}</p>
                                    <button onclick="downloadSingleImage(${index})" class="bg-blue-500 text-white px-2 py-1 rounded text-xs mt-1 hover:bg-blue-600 transition-colors">
                                        <i class="fas fa-download mr-1"></i>개별 다운로드
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                        <p class="text-sm text-indigo-600 mt-3 text-center">💡 이미지를 클릭하거나 다운로드 버튼을 눌러 개별 저장 가능</p>
                    </div>
                `;
            } else {
                imagePreviewHtml = `
                    <div class="mb-4 p-4 bg-gray-50 rounded-lg" id="modalImagePreview">
                        <p class="text-gray-500 text-center">업로드된 이미지가 없습니다.</p>
                    </div>
                `;
            }
            
            // 기존 내용에 이미지 미리보기 추가
            const existingImagePreview = document.getElementById('modalImagePreview');
            if (existingImagePreview) {
                existingImagePreview.remove();
            }
            
            // 버튼들 앞에 이미지 미리보기 삽입
            const buttonContainer = modalContent.querySelector('.space-y-3');
            buttonContainer.insertAdjacentHTML('beforebegin', imagePreviewHtml);
        }

        // 작업지시서 HTML 파일만 다운로드 (이미지는 HTML 내 임베디드)
        async function downloadAllAsZipDirect() {
            try {
                console.log('다운로드 함수 시작');
                
                if (!orderData) {
                    alert('❌ 작업지시서 데이터가 없습니다. 다시 시도해 주세요.');
                    return;
                }
                
                const timestamp = new Date().toISOString().slice(0, 10);
                const brandName = orderData.brandName || 'unnamed';
                
                // 작업지시서 HTML 파일 다운로드 (이미지 포함)
                console.log('작업지시서 HTML 파일 생성');
                const htmlContent = createOrderSummaryHTML();
                const htmlBlob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
                const htmlFileName = `끈스튜디오_작업지시서_${brandName}_${timestamp}.html`;
                
                // HTML 파일 다운로드
                const htmlLink = document.createElement('a');
                htmlLink.href = URL.createObjectURL(htmlBlob);
                htmlLink.download = htmlFileName;
                document.body.appendChild(htmlLink);
                htmlLink.click();
                document.body.removeChild(htmlLink);
                
                console.log('HTML 파일 다운로드 완료:', htmlFileName);
                
                // 성공 메시지 표시
                const imageCount = orderData.images ? orderData.images.length : 0;
                
                alert(`✅ 작업지시서 다운로드 완료!

📄 다운로드된 파일: ${htmlFileName}
${imageCount > 0 ? `🖼️ 이미지 ${imageCount}장이 HTML 파일에 포함되어 있습니다` : '📸 업로드된 이미지가 없습니다'}

💡 사용 방법:
• HTML 파일을 더블클릭하면 작업지시서를 볼 수 있습니다
• 이미지도 함께 볼 수 있으며 브라우저에서 오른쪽 클릭으로 저장 가능합니다
• 카카오톡으로 작업지시서를 공유해 주세요!`);
                
            } catch (error) {
                console.error('다운로드 오류:', error);
                alert('다운로드 중 오류가 발생했습니다: ' + error.message);
            }
        }

        // 알림 모달 표시
        function showNotification(title, message, iconClass = 'fa-check-circle', iconColor = 'text-green-500') {
            const modal = document.getElementById('notificationModal');
            const icon = document.getElementById('notificationIcon');
            const titleEl = document.getElementById('notificationTitle');
            const messageEl = document.getElementById('notificationMessage');
            
            icon.className = `fas ${iconClass} text-5xl ${iconColor} mb-4`;
            titleEl.textContent = title;
            messageEl.textContent = message;
            
            modal.classList.remove('hidden');
            modal.classList.add('flex', 'modal-enter');
        }
        
        // 알림 모달 닫기
        function closeNotification() {
            const modal = document.getElementById('notificationModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex', 'modal-enter');
        }

        // 링크 복사 기능
        function sendToKakao() {
            // 주문 데이터를 Base64로 인코딩하여 URL에 포함
            const encodedData = encodeOrderDataToURL();
            
            // GitHub Pages URL을 사용 (환경에 따라 자동 감지)
            const baseUrl = getBaseUrl();
            const shareUrl = `${baseUrl}#data=${encodedData}`;
            
            console.log('생성된 공유 링크:', shareUrl);
            
            // 링크를 클립보드에 복사
            copyLinkToClipboard(shareUrl);
        }
        
        // 기본 URL 가져오기 (GitHub Pages 우선)
        function getBaseUrl() {
            console.log('현재 호스트명:', window.location.hostname);
            console.log('현재 전체 URL:', window.location.href);
            
            // GitHub Pages URL이 있는 경우 우선 사용
            if (window.location.hostname.includes('github.io')) {
                const fullUrl = `https://${window.location.hostname}${window.location.pathname}`;
                console.log('GitHub Pages URL 사용:', fullUrl);
                return fullUrl;
            }
            
            // 로컬 개발 환경이나 다른 호스팅에서 GitHub Pages URL 사용
            const githubPagesUrl = 'https://wonchoiii.github.io/github.io-worksheet/';
            console.log('기본 GitHub Pages URL 사용:', githubPagesUrl);
            
            return githubPagesUrl;
        }
        
        // 주문 데이터를 URL에 인코딩 (이미지 제외)
        function encodeOrderDataToURL() {
            // 이미지는 너무 커서 URL에 포함하지 않고, 텍스트 정보만 포함
            const dataToEncode = {
                brandName: orderData.brandName || '',
                concept: orderData.concept || '',
                gender: orderData.gender || '',
                race: orderData.race || '',
                locations: orderData.locations || [],
                customLocation: orderData.customLocation || '',
                contact: orderData.contact || '',
                additionalRequest: orderData.additionalRequest || '',
                imageCount: (orderData.images && orderData.images.length > 0) ? orderData.images.length : 0,
                imageNames: (orderData.images && orderData.images.length > 0) ? 
                    orderData.images.map(img => img.name) : [],
                timestamp: orderData.timestamp || new Date().toLocaleString('ko-KR')
            };
            
            console.log('인코딩할 데이터 (이미지 제외):', dataToEncode);
            
            try {
                // JSON을 문자열로 변환 후 Base64로 인코딩
                const jsonString = JSON.stringify(dataToEncode);
                const encoded = btoa(encodeURIComponent(jsonString));
                
                console.log('JSON 길이:', jsonString.length);
                console.log('인코딩된 데이터 길이:', encoded.length);
                
                // URL 길이 검증 (2000자 미만)
                if (encoded.length > 2000) {
                    console.warn('인코딩된 데이터가 여전히 큽니다:', encoded.length, '문자');
                    alert('⚠️ 입력된 정보가 너무 많아서 링크 생성에 실패했습니다.\n텍스트를 줄여서 다시 시도해 주세요.');
                    return '';
                }
                
                return encoded;
            } catch (error) {
                console.error('데이터 인코딩 오류:', error);
                alert('데이터 인코딩 중 오류가 발생했습니다. 다시 시도해 주세요.');
                return '';
            }
        }
        

        


        // 모바일 기기 감지
        function isMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }



        // 공유된 데이터 확인 및 표시
        function checkForSharedData() {
            const hash = window.location.hash;
            if (hash.startsWith('#data=')) {
                const encodedData = hash.substring(6);
                try {
                    const jsonString = decodeURIComponent(atob(encodedData));
                    const sharedData = JSON.parse(jsonString);
                    displaySharedOrderData(sharedData);
                } catch (error) {
                    console.error('공유 데이터 디코딩 오류:', error);
                }
            }
        }
        
        // 공유된 주문 데이터 표시
        function displaySharedOrderData(data) {
            // 폼을 숨기고 공유 데이터 표시 영역 생성
            document.querySelector('.bg-white.rounded-2xl').style.display = 'none';
            
            const sharedContainer = document.createElement('div');
            sharedContainer.className = 'bg-white rounded-2xl shadow-xl overflow-hidden';
            sharedContainer.innerHTML = `
                <div class="bg-gradient-to-r from-green-500 to-teal-600 px-8 py-6">
                    <h2 class="text-2xl font-bold text-white flex items-center">
                        <i class="fas fa-file-alt mr-3"></i>
                        공유된 작업지시서
                    </h2>
                    <p class="text-green-100 mt-2">작업지시서 정보를 확인하세요</p>
                </div>
                
                <div class="p-8">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-700 mb-4">📋 기본 정보</h3>
                            <div class="space-y-2">
                                <p><strong>브랜드명:</strong> ${data.brandName}</p>
                                <p><strong>모델:</strong> ${data.gender} / ${data.race}</p>
                                <p><strong>연락처:</strong> ${data.contact}</p>
                                <p><strong>작성일시:</strong> ${data.timestamp}</p>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-semibold text-gray-700 mb-4">📍 촬영 정보</h3>
                            <div class="space-y-2">
                                <p><strong>촬영 장소:</strong> ${data.locations ? data.locations.join(', ') : '-'}${data.customLocation ? ` (${data.customLocation})` : ''}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-700 mb-2">💡 제작 컨셉</h3>
                        <p class="bg-gray-50 p-4 rounded-lg">${data.concept}</p>
                    </div>
                    
                    ${data.additionalRequest ? `
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-700 mb-2">💬 추가 요청사항</h3>
                            <p class="bg-gray-50 p-4 rounded-lg">${data.additionalRequest}</p>
                        </div>
                    ` : ''}
                    
                    ${data.imageCount && data.imageCount > 0 ? `
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-700 mb-4">📸 첨부된 상품사진 정보</h3>
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <p><strong>업로드된 이미지:</strong> ${data.imageCount}장</p>
                                ${data.imageNames && data.imageNames.length > 0 ? `
                                    <div class="mt-2">
                                        <p><strong>파일명:</strong></p>
                                        <ul class="list-disc list-inside mt-1 text-sm text-gray-600">
                                            ${data.imageNames.map(name => `<li>${name}</li>`).join('')}
                                        </ul>
                                    </div>
                                ` : ''}
                                <p class="text-sm text-orange-600 mt-2">💡 실제 이미지는 링크에 포함되지 않습니다. 별도로 전송해 주세요.</p>
                            </div>
                        </div>
                    ` : `
                        <div class="mb-6">
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <p class="text-gray-500">업로드된 상품사진이 없습니다.</p>
                            </div>
                        </div>
                    `}
                    
                    <div class="text-center pt-6 border-t">
                        <button onclick="location.reload()" class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition-colors">
                            <i class="fas fa-plus mr-2"></i>새 작업지시서 작성하기
                        </button>
                    </div>
                </div>
            `;
            
            // 기존 폼 컨테이너 뒤에 추가
            document.querySelector('.container > .bg-white').parentNode.appendChild(sharedContainer);
            
            // 전역 변수에 공유 데이터 저장
            window.sharedOrderData = data;
        }
        

        
        // 링크 복사 전용 함수
        function copyLinkToClipboard(url) {
            // URL 길이 확인 및 표시
            console.log('복사할 링크 길이:', url.length);
            console.log('복사할 링크:', url);
            
            navigator.clipboard.writeText(url).then(() => {
                // 성공적으로 복사된 경우
                showCopySuccessMessage(url);
            }).catch((error) => {
                console.error('클립보드 복사 실패:', error);
                // 폴백: 텍스트 선택 방식
                try {
                    const textArea = document.createElement('textarea');
                    textArea.value = url;
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-999999px';
                    textArea.style.top = '-999999px';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    
                    const successful = document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    if (successful) {
                        showCopySuccessMessage(url);
                    } else {
                        showCopyFailureMessage(url);
                    }
                } catch (err) {
                    console.error('폴백 복사도 실패:', err);
                    showCopyFailureMessage(url);
                }
            });
        }
        
        // 복사 성공 메시지 표시
        function showCopySuccessMessage(url) {
            const shortUrl = url.length > 80 ? url.substring(0, 80) + '...' : url;
            
            // 포함된 데이터 요약
            const dataInfo = [];
            if (orderData.brandName) dataInfo.push('브랜드 정보');
            if (orderData.concept) dataInfo.push('컨셉 설명');
            if (orderData.gender || orderData.race) dataInfo.push('모델 정보');
            if (orderData.contact) dataInfo.push('연락처');
            if (orderData.images && orderData.images.length > 0) dataInfo.push(`상품사진 정보 (${orderData.images.length}장)`);
            
            const includesText = dataInfo.length > 0 ? `\n\n📦 포함된 내용: ${dataInfo.join(', ')}` : '';
            
            alert(`✅ 작업지시서 공유 링크가 생성되었습니다!

📋 복사된 링크: ${shortUrl}${includesText}

💡 사용 방법:
• 카카오톡에 링크를 붙여넣기하여 공유
• 링크를 클릭하면 작업지시서 정보를 확인 가능
• 상품사진은 별도로 전송해 주세요

⚠️ 참고사항:
• 링크에는 텍스트 정보만 포함됩니다
• 실제 이미지는 파일이 커서 링크에 포함되지 않습니다`);
        }
        
        // 복사 실패 메시지 표시
        function showCopyFailureMessage(url) {
            const shortUrl = url.length > 60 ? url.substring(0, 60) + '...' : url;
            alert(`❌ 자동 복사에 실패했습니다.

📋 아래 링크를 수동으로 복사해서 카카오톡으로 보내주세요:

${url}

💡 링크를 길게 눌러서 전체 선택 후 복사하세요.`);
        }


        

        
        // 작업지시서를 HTML 형태로 생성
        function createOrderSummaryHTML() {
            const locations = orderData.locations ? orderData.locations.join(', ') : '선택안함';
            const customLocation = orderData.customLocation ? ` (기타: ${orderData.customLocation})` : '';
            
            // 이미지 섹션 HTML 생성
            let imagesHTML = '';
            if (orderData.images && orderData.images.length > 0) {
                imagesHTML = `
                <div class="section-card">
                    <h2>📸 첨부된 상품사진 (${orderData.images.length}장)</h2>
                    <div class="image-grid">
                        ${orderData.images.map((img, index) => `
                            <div class="image-item">
                                <img src="${img.url}" alt="${img.name}" class="product-image">
                                <p class="image-name">${img.name}</p>
                                <p class="image-size">${formatFileSize(img.file.size)}</p>
                            </div>
                        `).join('')}
                    </div>
                    <p class="note">💡 실제 이미지 파일은 별도로 다운로드하시기 바랍니다.</p>
                </div>`;
            }
            
            return `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>끈스튜디오 - AI 피팅 촬영 작업지시서</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8fafc;
            margin: 0;
            padding: 20px;
            color: #334155;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2rem;
            font-weight: 700;
        }
        .header p {
            margin: 0.5rem 0 0;
            opacity: 0.9;
        }
        .content {
            padding: 2rem;
        }
        .section-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .section-card h2 {
            margin: 0 0 1rem;
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
            border-bottom: 2px solid #6366f1;
            padding-bottom: 0.5rem;
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }
        .info-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 0;
        }
        .info-label {
            font-weight: 500;
            margin-right: 0.5rem;
            color: #475569;
        }
        .info-value {
            color: #1e293b;
        }
        .concept-box {
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 1rem;
            margin-top: 0.5rem;
        }
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 1rem 0;
        }
        .image-item {
            text-align: center;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
        }
        .image-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        }
        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            border: 1px solid #d1d5db;
        }
        .product-image:hover {
            opacity: 0.9;
        }
        .image-name {
            font-size: 0.875rem;
            font-weight: 500;
            margin: 0.5rem 0 0.25rem;
            color: #374151;
        }
        .image-size {
            font-size: 0.75rem;
            color: #6b7280;
            margin: 0;
        }
        .note {
            font-size: 0.875rem;
            color: #6366f1;
            background: #eef2ff;
            padding: 0.75rem;
            border-radius: 6px;
            margin-top: 1rem;
        }
        .footer {
            background: #1e293b;
            color: white;
            text-align: center;
            padding: 1.5rem;
            margin-top: 2rem;
        }
        .footer p {
            margin: 0.25rem 0;
        }
        @media (max-width: 640px) {
            .container { margin: 10px; }
            .header { padding: 1.5rem; }
            .content { padding: 1rem; }
            .info-grid { grid-template-columns: 1fr; }
            .image-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎬 끈스튜디오</h1>
            <p>AI 피팅 촬영 작업지시서</p>
            <p style="font-size: 0.875rem;">작성일시: ${orderData.timestamp}</p>
        </div>
        
        <div class="content">
            <div class="section-card">
                <h2>📋 기본 정보</h2>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">브랜드명:</span>
                        <span class="info-value">${orderData.brandName || '-'}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">연락처:</span>
                        <span class="info-value">${orderData.contact || '-'}</span>
                    </div>
                </div>
            </div>
            
            <div class="section-card">
                <h2>💡 제작 컨셉</h2>
                <div class="concept-box">
                    ${(orderData.concept || '내용 없음').replace(/\n/g, '<br>')}
                </div>
            </div>
            
            <div class="section-card">
                <h2>👥 모델 정보</h2>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">성별:</span>
                        <span class="info-value">${orderData.gender || '-'}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">인종:</span>
                        <span class="info-value">${orderData.race || '-'}</span>
                    </div>
                </div>
            </div>
            
            <div class="section-card">
                <h2>📍 촬영 정보</h2>
                <div class="info-item">
                    <span class="info-label">촬영 장소:</span>
                    <span class="info-value">${locations}${customLocation}</span>
                </div>
            </div>
            
            ${orderData.additionalRequest ? `
            <div class="section-card">
                <h2>💬 추가 요청사항</h2>
                <div class="concept-box">
                    ${orderData.additionalRequest.replace(/\n/g, '<br>')}
                </div>
            </div>
            ` : ''}
            
            ${imagesHTML}
        </div>
        
        <div class="footer">
            <p><strong>© 2024 끈스튜디오 - AI 피팅 촬영 서비스</strong></p>
            <p>카카오톡 채널: @kkeunstudio</p>
        </div>
    </div>
</body>
</html>`;
        }
        
        // 파일 크기 포맷팅 함수
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // 이미지 전체 크기로 보기 기능
        function viewFullImage(imageSrc, imageName) {
            // 모달 생성
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            modal.onclick = function() {
                document.body.removeChild(modal);
            };
            
            modal.innerHTML = `
                <div class="max-w-4xl max-h-full p-4">
                    <div class="relative">
                        <img src="${imageSrc}" alt="${imageName}" class="max-w-full max-h-screen object-contain rounded-lg">
                        <button onclick="event.stopPropagation(); document.body.removeChild(this.closest('.fixed'))" 
                                class="absolute top-4 right-4 bg-white text-black rounded-full w-10 h-10 flex items-center justify-center hover:bg-gray-200 transition-colors">
                            <i class="fas fa-times text-lg"></i>
                        </button>
                        <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white p-4 rounded-b-lg">
                            <p class="text-center font-medium">${imageName}</p>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // 클립보드에 복사 (기존 함수 유지)
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('📋 링크가 클립보드에 복사되었습니다!\n\n💡 카카오톡을 열어서 원하는 대화방에 붙여넣기 해주세요.');
            }).catch(() => {
                // 폴백: 텍스트 선택
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('📋 링크가 복사되었습니다!\n\n💡 카카오톡을 열어서 원하는 대화방에 붙여넣기 해주세요.');
            });
        }






    </script>
</body>
</html><!-- Updated Thu Sep 18 15:00:00 UTC 2025 -->
<!-- Cache busted: 2025091815 -->
